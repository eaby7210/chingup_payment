<!DOCTYPE html>
<html>
<head>
    <title>Payment Page</title>
</head>
<body>
    <!-- Chingup Payment Iframe -->
    <iframe id="payment_iframe" src="https://chingup.com/card_payment/" style="width:100%; height:420px;" frameborder="0"></iframe>

    <script>
        const iframe = document.getElementById('payment_iframe');

        // Listen for payment data from GHL
        window.addEventListener("message", function(event) {
            if (event.data.type === "payment_initiate_props") {
                const paymentData = event.data;

                // Extract payment details
                const amount = paymentData.amount;
                const transactionId = paymentData.transactionId;
                const currency = paymentData.currency;

                // Send payment data to Chingup iframe
                iframe.onload = function() {
                    const chingupPaymentData = {
                        amount: amount,
                        merchant_id: 'YOUR_MERCHANT_ID', // Your Chingup merchant_id
                        type: "paymentData",
                        transaction_id: transactionId // From GHL
                    };
                    iframe.contentWindow.postMessage(chingupPaymentData, "*");
                };
            }
        });

        // Listen for payment response from Chingup iframe
        window.addEventListener("message", function(event) {
            const response = event.data;
            if (response && typeof response === 'object' && 'success' in response) {
                if (response.success) {
                    // Dispatch success event to GHL
                    window.parent.postMessage({ type: 'custom_element_success_response', chargeId: response.transaction_id }, "*");
                } else {
                    // Dispatch error event to GHL
                    window.parent.postMessage({ type: 'custom_element_error_response', error: { description: response.message } }, "*");
                }
            }
        });
    </script>
</body>
</html>